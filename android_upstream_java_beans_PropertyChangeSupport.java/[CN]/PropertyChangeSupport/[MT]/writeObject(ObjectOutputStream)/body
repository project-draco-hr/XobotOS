{
  Map<String,PropertyChangeSupport> map=new Hashtable<String,PropertyChangeSupport>();
  for (  PropertyChangeListener p : listeners) {
    if (p instanceof PropertyChangeListenerProxy && !(p instanceof Serializable)) {
      PropertyChangeListenerProxy proxy=(PropertyChangeListenerProxy)p;
      PropertyChangeListener listener=(PropertyChangeListener)proxy.getListener();
      if (listener instanceof Serializable) {
        PropertyChangeSupport list=map.get(proxy.getPropertyName());
        if (list == null) {
          list=new PropertyChangeSupport(sourceBean);
          map.put(proxy.getPropertyName(),list);
        }
        list.listeners.add(listener);
      }
    }
  }
  ObjectOutputStream.PutField putFields=out.putFields();
  putFields.put("source",sourceBean);
  putFields.put("children",map);
  out.writeFields();
  for (  PropertyChangeListener p : listeners) {
    if (p instanceof Serializable) {
      out.writeObject(p);
    }
  }
  out.writeObject(null);
}
