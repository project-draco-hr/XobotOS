{
  final Field f=ObjectStreamClass.fieldSerialPersistentFields(this.forClass());
  boolean useReflectFields=f == null;
  ObjectStreamField[] _fields=null;
  if (!useReflectFields) {
    f.setAccessible(true);
    try {
      _fields=(ObjectStreamField[])f.get(null);
    }
 catch (    IllegalAccessException ex) {
      throw new AssertionError(ex);
    }
  }
 else {
    List<ObjectStreamField> serializableFields=new ArrayList<ObjectStreamField>(declaredFields.length);
    for (    Field declaredField : declaredFields) {
      int modifiers=declaredField.getModifiers();
      if (!Modifier.isStatic(modifiers) && !Modifier.isTransient(modifiers)) {
        ObjectStreamField field=new ObjectStreamField(declaredField.getName(),declaredField.getType());
        serializableFields.add(field);
      }
    }
    if (serializableFields.size() == 0) {
      _fields=NO_FIELDS;
    }
 else {
      _fields=serializableFields.toArray(new ObjectStreamField[serializableFields.size()]);
    }
  }
  Arrays.sort(_fields);
  int primOffset=0, objectOffset=0;
  for (int i=0; i < _fields.length; i++) {
    Class<?> type=_fields[i].getType();
    if (type.isPrimitive()) {
      _fields[i].offset=primOffset;
      primOffset+=primitiveSize(type);
    }
 else {
      _fields[i].offset=objectOffset++;
    }
  }
  fields=_fields;
}
