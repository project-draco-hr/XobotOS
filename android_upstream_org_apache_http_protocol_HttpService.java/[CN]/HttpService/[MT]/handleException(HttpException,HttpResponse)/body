{
  if (ex instanceof MethodNotSupportedException) {
    response.setStatusCode(HttpStatus.SC_NOT_IMPLEMENTED);
  }
 else   if (ex instanceof UnsupportedHttpVersionException) {
    response.setStatusCode(HttpStatus.SC_HTTP_VERSION_NOT_SUPPORTED);
  }
 else   if (ex instanceof ProtocolException) {
    response.setStatusCode(HttpStatus.SC_BAD_REQUEST);
  }
 else {
    response.setStatusCode(HttpStatus.SC_INTERNAL_SERVER_ERROR);
  }
  byte[] msg=EncodingUtils.getAsciiBytes(ex.getMessage());
  ByteArrayEntity entity=new ByteArrayEntity(msg);
  entity.setContentType("text/plain; charset=US-ASCII");
  response.setEntity(entity);
}
