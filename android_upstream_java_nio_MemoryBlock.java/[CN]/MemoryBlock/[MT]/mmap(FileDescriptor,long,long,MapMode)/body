{
  if (size == 0) {
    return new MemoryBlock(0,0);
  }
  if (offset < 0 || size < 0 || offset > Integer.MAX_VALUE || size > Integer.MAX_VALUE) {
    throw new IllegalArgumentException("offset=" + offset + " size="+ size);
  }
  int prot;
  int flags;
  if (mapMode == MapMode.PRIVATE) {
    prot=PROT_READ | PROT_WRITE;
    flags=MAP_PRIVATE;
  }
 else   if (mapMode == MapMode.READ_ONLY) {
    prot=PROT_READ;
    flags=MAP_SHARED;
  }
 else {
    prot=PROT_READ | PROT_WRITE;
    flags=MAP_SHARED;
  }
  try {
    int address=(int)Libcore.os.mmap(0L,size,prot,flags,fd,offset);
    return new MemoryMappedBlock(address,size);
  }
 catch (  ErrnoException errnoException) {
    throw errnoException.rethrowAsIOException();
  }
}
