{
  int dstOffset=fields[DST_OFFSET];
  if (!isCached || newTimeMillis >= nextMidnightMillis || newTimeMillis <= lastMidnightMillis || cachedFields[4] != zoneOffset || (dstOffset == 0 && (newTimeMillisAdjusted >= nextMidnightMillis)) || (dstOffset != 0 && (newTimeMillisAdjusted <= lastMidnightMillis))) {
    fullFieldsCalc(timeVal,millis,zoneOffset);
    isCached=false;
  }
 else {
    fields[YEAR]=cachedFields[0];
    fields[MONTH]=cachedFields[1];
    fields[DATE]=cachedFields[2];
    fields[DAY_OF_WEEK]=cachedFields[3];
    fields[ERA]=cachedFields[5];
    fields[WEEK_OF_YEAR]=cachedFields[6];
    fields[WEEK_OF_MONTH]=cachedFields[7];
    fields[DAY_OF_YEAR]=cachedFields[8];
    fields[DAY_OF_WEEK_IN_MONTH]=cachedFields[9];
  }
}
