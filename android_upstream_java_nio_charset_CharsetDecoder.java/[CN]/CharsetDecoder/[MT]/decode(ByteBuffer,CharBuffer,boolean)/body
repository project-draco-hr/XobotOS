{
  if ((status == FLUSH) || (!endOfInput && status == END)) {
    throw new IllegalStateException();
  }
  CoderResult result=null;
  while (true) {
    CodingErrorAction action=null;
    try {
      result=decodeLoop(in,out);
    }
 catch (    BufferOverflowException ex) {
      throw new CoderMalfunctionError(ex);
    }
catch (    BufferUnderflowException ex) {
      throw new CoderMalfunctionError(ex);
    }
    if (result.isUnderflow()) {
      int remaining=in.remaining();
      status=endOfInput ? END : ONGOING;
      if (endOfInput && remaining > 0) {
        result=CoderResult.malformedForLength(remaining);
      }
 else {
        return result;
      }
    }
    if (result.isOverflow()) {
      return result;
    }
    action=malformedInputAction;
    if (result.isUnmappable()) {
      action=unmappableCharacterAction;
    }
    if (action == CodingErrorAction.REPLACE) {
      if (out.remaining() < replacementChars.length()) {
        return CoderResult.OVERFLOW;
      }
      out.put(replacementChars);
    }
 else {
      if (action != CodingErrorAction.IGNORE)       return result;
    }
    in.position(in.position() + result.length());
  }
}
