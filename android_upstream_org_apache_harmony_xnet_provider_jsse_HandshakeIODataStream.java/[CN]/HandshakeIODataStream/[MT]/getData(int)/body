{
  byte[] res;
  if (write_pos - write_pos_beg < length) {
    res=new byte[write_pos - write_pos_beg];
    System.arraycopy(buffer,write_pos_beg,res,0,write_pos - write_pos_beg);
    write_pos_beg=write_pos;
  }
 else {
    res=new byte[length];
    System.arraycopy(buffer,write_pos_beg,res,0,length);
    write_pos_beg+=length;
  }
  return res;
}
