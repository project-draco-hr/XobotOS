{
  if (buffer == null || in == -1) {
    return 0;
  }
  return in <= out ? buffer.length - out + in : in - out;
}
