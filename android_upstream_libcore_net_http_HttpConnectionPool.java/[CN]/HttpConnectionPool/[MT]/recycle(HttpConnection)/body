{
  final Socket socket=connection.getSocket();
  try {
    SocketTagger.get().untag(socket);
  }
 catch (  SocketException e) {
    System.logW("Unable to untagSocket(): " + e);
    connection.closeSocketAndStreams();
    return;
  }
  if (maxConnections > 0 && connection.isEligibleForRecycling()) {
    HttpConnection.Address address=connection.getAddress();
synchronized (connectionPool) {
      List<HttpConnection> connections=connectionPool.get(address);
      if (connections == null) {
        connections=new ArrayList<HttpConnection>();
        connectionPool.put(address,connections);
      }
      if (connections.size() < maxConnections) {
        connections.add(connection);
        return;
      }
    }
  }
  connection.closeSocketAndStreams();
}
